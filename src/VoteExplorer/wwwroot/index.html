<!DOCTYPE html>
<html>
<head>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link href="app.css" rel="stylesheet">
    <script src="lib/web3/dist/web3.min.js"></script>
    <script src="lib/crypto-js/crypto-js.js"></script>
    <script>
        var accounts;
        var account;
        var foodSafeABI;
        var foodSafeContract;
        var foodSafeCode;
        window.App = {
            start: function () {
                var self = this;
                web3.eth.getAccounts(function (err, accs) {
                    if (err != null) {
                        alert("There was an error fetching your accounts.");
                        return;
                    }
                    if (accs.length == 0) {
                        alert("Couldn't get any accounts! Make sure your Ethereum client is configured correctly.");
                        return;
                    }

                    accounts = accs;
                    account = accounts[0];
                    web3.eth.defaultAccount = account;
                    var foodSafeSource = "pragma solidity ^0.4.11;  contract VoteSession { bytes32[] _questions; bool[] _questionIsActive; address _owner; address _voteToken;  mapping(address => bytes32) _voteSelections; mapping(address => bytes32) _voteSessionIds; mapping(address => uint) _hasVoted; address[] _voteSelectionsAddresses;  function VoteSession() { _owner = msg.sender; }  function setVoteTokenAddress(address voteToken) returns (bool setTokenId){ require(msg.sender==_owner); _voteToken = voteToken;  return true; }    function getVoteTokenAddress() returns (address VoteToken) { return _voteToken; }  function vote(string voteSessionId, string selectedAnswers) returns (bool Result) {        if (_hasVoted[msg.sender] == 0) { _hasVoted[msg.sender] = 1; _voteSelectionsAddresses.push(msg.sender); }  _voteSessionIds[msg.sender] = stringToBytes32(voteSessionId); _voteSelections[msg.sender] = stringToBytes32(selectedAnswers);  return true; }  function getLastVoteSessionId() returns (string voteSessionId1) { string memory voteSessionId;  if (_hasVoted[msg.sender] == 0) { voteSessionId = \"\";            } else { voteSessionId = bytes32ToString(_voteSessionIds[msg.sender]); }  return voteSessionId; }  function totalVoters() returns (uint256 totalVoters) { return _voteSelectionsAddresses.length; }  function getVoteAnswers() returns (string voteAnswers) { return bytes32ToString(_voteSelections[msg.sender]); }  function getVoteAnswersByIndex(uint256 voterIndex) returns (address voter, string voteAnswers) { address selectedAddress = _voteSelectionsAddresses[voterIndex]; return (selectedAddress, bytes32ToString(_voteSelections[selectedAddress])); }   function addQuestion(string question) returns (bool added) { require(msg.sender == _owner && _voteSelectionsAddresses.length == 0); _questions.push(stringToBytes32(question)); _questionIsActive.push(true);  return true; }  function removeQuestionAtIndex(uint questionIndex) returns (bool removed) { require(msg.sender == _owner && _voteSelectionsAddresses.length == 0);  _questionIsActive[questionIndex] = false;                 return true; }  function editQuestionAtIndex(uint questionIndex, string question) returns (bool updated) { require(msg.sender == _owner && _voteSelectionsAddresses.length == 0); _questions[questionIndex] = stringToBytes32(question);  return true; }  function totalQuestions() returns (uint totalQuestions) { return _questions.length; }  function getQuestionByIndex(uint questionIndex) returns (string question, bool isActive) { return (bytes32ToString(_questions[questionIndex]),_questionIsActive[questionIndex]); }  function stringToBytes32(string memory source) returns (bytes32 result) { assembly { result := mload(add(source, 32)) } }  function bytes32ToString(bytes32 x) constant returns (string) { bytes memory bytesString = new bytes(32); uint charCount = 0; for (uint j = 0; j < 32; j++) { byte char = byte(bytes32(uint(x) * 2 ** (8 * j))); if (char != 0) { bytesString[charCount] = char; charCount++; } } bytes memory bytesStringTrimmed = new bytes(charCount); for (j = 0; j < charCount; j++) { bytesStringTrimmed[j] = bytesString[j]; } return string(bytesStringTrimmed); }  }";
                    web3.eth.compile.solidity(foodSafeSource, function (error, foodSafeCompiled) {
                        console.log(error);
                        console.log(foodSafeCompiled);

                        if (foodSafeCompiled != null) {
                            //console.log("foodSafeCompiled =" + JSON.stringify(foodSafeCompiled));
                            console.log("ABI=" + JSON.stringify(foodSafeCompiled['<stdin>:VoteSession'].info.abiDefinition));
                            foodSafeABI = foodSafeCompiled['<stdin>:VoteSession'].info.abiDefinition;
                            document.getElementById("ABI").value = JSON.stringify(foodSafeCompiled['<stdin>:VoteSession'].info.abiDefinition);
                            foodSafeContract = web3.eth.contract(foodSafeABI);
                            foodSafeCode = foodSafeCompiled['<stdin>:VoteSession'].code
                            document.getElementById("byteCode").value = foodSafeCompiled['<stdin>:VoteSession'].code;
                        }
                        else {
                            votingTokenABI = "[{\"constant\":true,\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_spender\",\"type\":\"address\"},{\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"name\":\"success\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"name\":\"\",\"type\":\"uint8\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"_totalSupply\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_from\",\"type\":\"address\"},{\"name\":\"_to\",\"type\":\"address\"},{\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"transferfrom\",\"outputs\":[{\"name\":\"success\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_owner\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"name\":\"balance\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_to\",\"type\":\"address\"},{\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"name\":\"success\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_owner\",\"type\":\"address\"},{\"name\":\"_spender\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"name\":\"remaining\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"inputs\":[],\"payable\":false,\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"_from\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"_to\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"_owner\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"_spender\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"Approval\",\"type\":\"event\"}]";
                            votingTokenCode = "6060604052341561000f57600080fd5b5b600160a060020a03331660009081526020819052604090206298968090555b5b6106078061003f6000396000f300606060405236156100965763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166306fdde03811461009b578063095ea7b314610126578063313ce5671461015c5780633eaaf86b1461018557806363b0545f146101aa57806370a08231146101e657806395d89b4114610217578063a9059cbb146102a2578063dd62ed3e146102d8575b600080fd5b34156100a657600080fd5b6100ae61030f565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100eb5780820151818401525b6020016100d2565b50505050905090810190601f1680156101185780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561013157600080fd5b610148600160a060020a0360043516602435610346565b604051901515815260200160405180910390f35b341561016757600080fd5b61016f6103b3565b60405160ff909116815260200160405180910390f35b341561019057600080fd5b6101986103b8565b60405190815260200160405180910390f35b34156101b557600080fd5b610148600160a060020a03600435811690602435166044356103bf565b604051901515815260200160405180910390f35b34156101f157600080fd5b610198600160a060020a03600435166104b5565b60405190815260200160405180910390f35b341561022257600080fd5b6100ae6104d4565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100eb5780820151818401525b6020016100d2565b50505050905090810190601f1680156101185780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156102ad57600080fd5b610148600160a060020a036004351660243561050b565b604051901515815260200160405180910390f35b34156102e357600080fd5b610198600160a060020a03600435811690602435166105ae565b60405190815260200160405180910390f35b60408051908101604052600f81527f41424320436f72706f726174696f6e0000000000000000000000000000000000602082015281565b600160a060020a03338116600081815260016020908152604080832094871680845294909152808220859055909291907f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259085905190815260200160405180910390a35060015b92915050565b600081565b6298968081565b600160a060020a038084166000908152600160209081526040808320339094168352929052908120548290108015906104115750600160a060020a038416600090815260208190526040902054829010155b801561041d5750600082115b151561042857600080fd5b600160a060020a0380851660008181526020818152604080832080548890039055878516808452818420805489019055848452600183528184203390961684529490915290819020805486900390557fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9085905190815260200160405180910390a35060015b9392505050565b600160a060020a0381166000908152602081905260409020545b919050565b60408051908101604052600381527f4142430000000000000000000000000000000000000000000000000000000000602082015281565b600160a060020a0333166000908152602081905260408120548290108015906105345750600082115b151561053f57600080fd5b600160a060020a033381166000818152602081905260408082208054879003905592861680825290839020805486019055917fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9085905190815260200160405180910390a35060015b92915050565b600160a060020a038083166000908152600160209081526040808320938516835292905220545b929150505600a165627a7a72305820472c7bedcf567ead2600a8b255e570815dd35ee7dd71cb083a3828e2f117d4c80029";

                            voteSessionABI = "[ { \"constant\": false, \"inputs\": [ { \"name\": \"voteToken\", \"type\": \"address\" } ], \"name\": \"setVoteTokenAddress\", \"outputs\": [ { \"name\": \"setTokenId\", \"type\": \"bool\" } ], \"payable\": false, \"type\": \"function\" }, { \"constant\": false, \"inputs\": [ { \"name\": \"votedAddress\", \"type\": \"address\" }, { \"name\": \"voteSessionId\", \"type\": \"string\" }, { \"name\": \"transactionId\", \"type\": \"string\" } ], \"name\": \"setVoteTransactionId\", \"outputs\": [ { \"name\": \"Result\", \"type\": \"bool\" } ], \"payable\": false, \"type\": \"function\" }, { \"constant\": false, \"inputs\": [ { \"name\": \"indexVoter\", \"type\": \"uint256\" }, { \"name\": \"voterAddress\", \"type\": \"address\" } ], \"name\": \"getVoteAnswersByAddress\", \"outputs\": [ { \"name\": \"indexVoter1\", \"type\": \"uint256\" }, { \"name\": \"voter\", \"type\": \"address\" }, { \"name\": \"voteSessionId\", \"type\": \"string\" }, { \"name\": \"voteAnswers\", \"type\": \"string\" }, { \"name\": \"blockNumber\", \"type\": \"uint256\" }, { \"name\": \"balance\", \"type\": \"uint256\" } ], \"payable\": false, \"type\": \"function\" }, { \"constant\": false, \"inputs\": [ { \"name\": \"voterIndex\", \"type\": \"uint256\" } ], \"name\": \"getVoteAnswersByIndex\", \"outputs\": [ { \"name\": \"indexVoter1\", \"type\": \"uint256\" }, { \"name\": \"voter\", \"type\": \"address\" }, { \"name\": \"voteSessionId\", \"type\": \"string\" }, { \"name\": \"voteAnswers\", \"type\": \"string\" }, { \"name\": \"blockNumber\", \"type\": \"uint256\" }, { \"name\": \"balance\", \"type\": \"uint256\" } ], \"payable\": false, \"type\": \"function\" }, { \"constant\": false, \"inputs\": [], \"name\": \"totalVoters\", \"outputs\": [ { \"name\": \"totalVoters\", \"type\": \"uint256\" } ], \"payable\": false, \"type\": \"function\" }, { \"constant\": false, \"inputs\": [], \"name\": \"getLastVoteSessionId\", \"outputs\": [ { \"name\": \"voteSessionId1\", \"type\": \"string\" } ], \"payable\": false, \"type\": \"function\" }, { \"constant\": false, \"inputs\": [], \"name\": \"getVoteAnswers\", \"outputs\": [ { \"name\": \"indexVoter1\", \"type\": \"uint256\" }, { \"name\": \"voter\", \"type\": \"address\" }, { \"name\": \"voteSessionId\", \"type\": \"string\" }, { \"name\": \"voteAnswers\", \"type\": \"string\" }, { \"name\": \"blockNumber\", \"type\": \"uint256\" }, { \"name\": \"balance\", \"type\": \"uint256\" } ], \"payable\": false, \"type\": \"function\" }, { \"constant\": false, \"inputs\": [ { \"name\": \"questionIndex\", \"type\": \"uint256\" } ], \"name\": \"getQuestionByIndex\", \"outputs\": [ { \"name\": \"questionIndex1\", \"type\": \"uint256\" }, { \"name\": \"questionId\", \"type\": \"string\" }, { \"name\": \"questionTextRows\", \"type\": \"uint256\" }, { \"name\": \"boardRecommendation\", \"type\": \"string\" }, { \"name\": \"isActive\", \"type\": \"uint256\" } ], \"payable\": false, \"type\": \"function\" }, { \"constant\": false, \"inputs\": [ { \"name\": \"questionId\", \"type\": \"string\" }, { \"name\": \"questionTextRows\", \"type\": \"uint256\" }, { \"name\": \"questionText\", \"type\": \"bytes32\" }, { \"name\": \"boardRecommendation\", \"type\": \"string\" }, { \"name\": \"isActive\", \"type\": \"uint256\" } ], \"name\": \"insertUpdateQuestion\", \"outputs\": [ { \"name\": \"insertupdate\", \"type\": \"bool\" } ], \"payable\": false, \"type\": \"function\" }, { \"constant\": true, \"inputs\": [ { \"name\": \"x\", \"type\": \"bytes32\" } ], \"name\": \"bytes32ToString\", \"outputs\": [ { \"name\": \"\", \"type\": \"string\" } ], \"payable\": false, \"type\": \"function\" }, { \"constant\": false, \"inputs\": [ { \"name\": \"questionId\", \"type\": \"string\" }, { \"name\": \"questionTextRow\", \"type\": \"uint256\" } ], \"name\": \"getQuestionTextByRow\", \"outputs\": [ { \"name\": \"questionid\", \"type\": \"string\" }, { \"name\": \"row\", \"type\": \"uint256\" }, { \"name\": \"textLine\", \"type\": \"bytes32\" } ], \"payable\": false, \"type\": \"function\" }, { \"constant\": false, \"inputs\": [ { \"name\": \"questionId\", \"type\": \"string\" }, { \"name\": \"questionTextRow\", \"type\": \"uint256\" }, { \"name\": \"questionText\", \"type\": \"bytes32\" } ], \"name\": \"addQuestionTextRow\", \"outputs\": [ { \"name\": \"success\", \"type\": \"bool\" } ], \"payable\": false, \"type\": \"function\" }, { \"constant\": false, \"inputs\": [], \"name\": \"totalQuestions\", \"outputs\": [ { \"name\": \"totalQuestions\", \"type\": \"uint256\" } ], \"payable\": false, \"type\": \"function\" }, { \"constant\": false, \"inputs\": [ { \"name\": \"source\", \"type\": \"string\" } ], \"name\": \"stringToBytes32\", \"outputs\": [ { \"name\": \"result\", \"type\": \"bytes32\" } ], \"payable\": false, \"type\": \"function\" }, { \"constant\": false, \"inputs\": [], \"name\": \"getVoteTokenAddress\", \"outputs\": [ { \"name\": \"VoteToken\", \"type\": \"address\" } ], \"payable\": false, \"type\": \"function\" }, { \"constant\": false, \"inputs\": [ { \"name\": \"voteSessionId\", \"type\": \"string\" }, { \"name\": \"selectedAnswers\", \"type\": \"string\" } ], \"name\": \"vote\", \"outputs\": [ { \"name\": \"Result\", \"type\": \"bool\" } ], \"payable\": false, \"type\": \"function\" }, { \"inputs\": [], \"payable\": false, \"type\": \"constructor\" } ]";
                            voteSessionCode = "0x6060604052341561000c57fe5b5b60038054600160a060020a03191633600160a060020a03161790555b5b610e3c806100396000396000f300606060405236156100b45763ffffffff60e060020a6000350416630f350d3481146100b65780631fe570fd146100e6578063231ca5751461010d5780635cdc08c1146101b55780635f5300ff1461025b578063661646321461027d57806374ce469f1461030d57806377e97f371461039d5780639201de55146104ad578063a0ec18eb14610540578063bea5b914146105e7578063cfb5192814610609578063e7f999fa14610671578063e8d5940d1461069d575bfe5b34156100be57fe5b6100d2600160a060020a0360043516610744565b604080519115158252519081900360200190f35b34156100ee57fe5b6100d2600435610787565b604080519115158252519081900360200190f35b341561011557fe5b60408051602060046024803582810135601f81018590048502860185019096528585526100d2958335959394604494939290920191819084018382808284375050604080516020601f89358b018035918201839004830284018301909452808352979998810197919650918201945092508291508401838280828437509496506107f995505050505050565b604080519115158252519081900360200190f35b34156101bd57fe5b6101c860043561087f565b60408051600160a060020a03841681526020808201838152845193830193909352835191929160608401918501908083838215610220575b80518252602083111561022057601f199092019160209182019101610200565b505050905090810190601f16801561024c5780820380516001836020036101000a031916815260200191505b50935050505060405180910390f35b341561026357fe5b61026b6108e4565b60408051918252519081900360200190f35b341561028557fe5b61028d6108eb565b6040805160208082528351818301528351919283929083019185019080838382156102d3575b8051825260208311156102d357601f1990920191602091820191016102b3565b505050905090810190601f1680156102ff5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561031557fe5b61028d61095c565b6040805160208082528351818301528351919283929083019185019080838382156102d3575b8051825260208311156102d357601f1990920191602091820191016102b3565b505050905090810190601f1680156102ff5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156103a557fe5b6103b060043561098c565b604080518215159181019190915260608082528451908201528351819060208083019160808401918801908083838215610405575b80518252602083111561040557601f1990920191602091820191016103e5565b505050905090810190601f1680156104315780820380516001836020036101000a031916815260200191505b5083810382528551815285516020918201918701908083838215610470575b80518252602083111561047057601f199092019160209182019101610450565b505050905090810190601f16801561049c5780820380516001836020036101000a031916815260200191505b509550505050505060405180910390f35b34156104b557fe5b61028d600435610a29565b6040805160208082528351818301528351919283929083019185019080838382156102d3575b8051825260208311156102d357601f1990920191602091820191016102b3565b505050905090810190601f1680156102ff5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561054857fe5b6100d2600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284375050604080516020601f89358b01803591820183900483028401830190945280835297999881019791965091820194509250829150840183828082843750949650610b6195505050505050565b604080519115158252519081900360200190f35b34156105ef57fe5b61026b610c2f565b60408051918252519081900360200190f35b341561061157fe5b61026b600480803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843750949650610c3695505050505050565b60408051918252519081900360200190f35b341561067957fe5b610681610c41565b60408051600160a060020a039092168252519081900360200190f35b34156106a557fe5b6100d2600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284375050604080516020601f89358b01803591820183900483028401830190945280835297999881019791965091820194509250829150840183828082843750949650610c5195505050505050565b604080519115158252519081900360200190f35b60035460009033600160a060020a039081169116146107635760006000fd5b5060048054600160a060020a031916600160a060020a03831617905560015b919050565b60035460009033600160a060020a0390811691161480156107a85750600854155b15156107b45760006000fd5b60006001838154811015156107c557fe5b90600052602060002090602091828204019190065b6101000a81548160ff021916908315150217905550600190505b919050565b60035460009033600160a060020a03908116911614801561081a5750600854155b15156108265760006000fd5b61082f82610c36565b600080548690811061083d57fe5b906000526020600020900160005b505561085683610c36565b600280548690811061086457fe5b906000526020600020900160005b50555060015b9392505050565b6000610889610d1c565b600060088481548110151561089a57fe5b906000526020600020900160005b9054600160a060020a036101009290920a90041660008181526005602052604090205490915081906108d990610a29565b925092505b50915091565b6008545b90565b6108f3610d1c565b6108fb610d1c565b600160a060020a033316600090815260076020526040902054151561092f5750604080516020810190915260008152610954565b600160a060020a03331660009081526006602052604090205461095190610a29565b90505b8091505b5090565b610964610d1c565b600160a060020a03331660009081526005602052604090205461098690610a29565b90505b90565b610994610d1c565b61099c610d1c565b60006109c56002858154811015156109b057fe5b906000526020600020900160005b5054610a29565b6109ec6000868154811015156109b057fe5b906000526020600020900160005b5054610a29565b60018054879081106109fa57fe5b90600052602060002090602091828204019190065b9054906101000a900460ff169250925092505b9193909250565b610a31610d1c565b610a39610d1c565b600060006000610a47610d1c565b6020604051805910610a565750595b908082528060200260200182016040525b50945060009350600092505b6020831015610ad1576008830260020a87029150600160f860020a0319821615610ac557818585815181101515610aa657fe5b906020010190600160f860020a031916908160001a9053506001909301925b5b600190920191610a73565b83604051805910610adf5750595b908082528060200260200182016040525b509050600092505b83831015610b53578483815181101515610b0e57fe5b90602001015160f860020a900460f860020a028184815181101515610b2f57fe5b906020010190600160f860020a031916908160001a9053505b600190920191610af8565b8095505b5050505050919050565b60035460009033600160a060020a039081169116148015610b825750600854155b1515610b8e5760006000fd5b6000805460018101610ba08382610d40565b916000526020600020900160005b610bb785610c36565b909155505060018054808201610bcd8382610d6a565b91600052602060002090602091828204019190065b815460ff6101009290920a9182021916179055506002805460018101610c088382610d40565b916000526020600020900160005b610c1f86610c36565b9091555060019150505b92915050565b6000545b90565b60208101515b919050565b600454600160a060020a03165b90565b600160a060020a0333166000908152600760205260408120541515610cce57600160a060020a03331660009081526007602052604090206001908190556008805490918101610ca08382610d40565b916000526020600020900160005b8154600160a060020a033381166101009390930a92830292021916179055505b610cd783610c36565b600160a060020a033316600090815260066020526040902055610cf982610c36565b600160a060020a0333166000908152600560205260409020555060015b92915050565b60408051602081019091526000815290565b60408051602081019091526000815290565b815481835581811511610d6457600083815260209020610d64918101908301610dce565b5b505050565b815481835581811511610d6457601f016020900481601f01602090048360005260206000209182019101610d649190610dce565b5b505050565b815481835581811511610d6457600083815260209020610d64918101908301610dce565b5b505050565b6108e891905b808211156109585760008155600101610dd4565b5090565b90565b6108e891905b808211156109585760008155600101610dd4565b5090565b905600a165627a7a7230582064447091d18da1745b4d62d73b4f865d838e93814f70503a96cc693fff2184b40029";


                            foodSafeABI = JSON.parse(voteSessionABI);
                            document.getElementById("ABI").value = JSON.stringify(foodSafeABI);
                            foodSafeContract = web3.eth.contract(foodSafeABI);
                            document.getElementById("byteCode").value = voteSessionCode;
                        }

                    });
                });
            },
            vote: function() {
                var votingSessionContractAddress = document.getElementById("contractAddress").value;

                var voteSessionContract = web3.eth.contract(JSON.parse(voteSessionABI));
                var deployedVotingSession = voteSessionContract.at(votingSessionContractAddress);
                deployedVotingSession.vote("Session1", "Choices", function (error, result) {
                    console.log("vote result" + result);
                });
                
            },
            testCall: function () {
                var votingSessionContractAddress = document.getElementById("contractAddress").value;

                var voteSessionContract = web3.eth.contract(JSON.parse(voteSessionABI));
                var deployedVotingSession = voteSessionContract.at(votingSessionContractAddress);
                
                votingTokenABI = "[{\"constant\":true,\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_spender\",\"type\":\"address\"},{\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"name\":\"success\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"name\":\"\",\"type\":\"uint8\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"_totalSupply\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_from\",\"type\":\"address\"},{\"name\":\"_to\",\"type\":\"address\"},{\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"transferfrom\",\"outputs\":[{\"name\":\"success\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_owner\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"name\":\"balance\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_to\",\"type\":\"address\"},{\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"name\":\"success\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_owner\",\"type\":\"address\"},{\"name\":\"_spender\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"name\":\"remaining\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"inputs\":[],\"payable\":false,\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"_from\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"_to\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"_owner\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"_spender\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"Approval\",\"type\":\"event\"}]";
                var votingTokenContract = web3.eth.contract(JSON.parse(votingTokenABI));
                var deployedVotingToken;

                deployedVotingSession.getVoteTokenAddress.call(function (error, voteTokenAdd) {
                    deployedVotingToken = votingTokenContract.at(voteTokenAdd);
                    deployedVotingToken.balanceOf.call(account, function (error, balance) {
                        console.log("balance =" + balance);
                        
                    })

                });

                //var deployedFoodSafe = foodSafeContract.at(contractAddress);
                //var locationSecret = document.getElementById("secret").value;
                //deployedFoodSafe.setVoteTokenAddress(locationSecret, function (error, transaction) {
                //    console.log(transaction);
                //})
                //foodSafeContract.new("", { from: account, data: foodSafeCode, gas: 3000000 }, function (error, deployedContract) {
                //    if (deployedContract.address) {
                //        document.getElementById("contractAddress").value = deployedContract.address;
                //    }
                //})
            },
            createContract: function () {
                var contractAddress = document.getElementById("contractAddress").value;
                var deployedFoodSafe = foodSafeContract.at(contractAddress);
                var locationSecret = document.getElementById("secret").value;
                deployedFoodSafe.setVoteTokenAddress(locationSecret, function (error, transaction) {
                    console.log(transaction);
                })
                //foodSafeContract.new("", { from: account, data: foodSafeCode, gas: 3000000 }, function (error, deployedContract) {
                //    if (deployedContract.address) {
                //        document.getElementById("contractAddress").value = deployedContract.address;
                //    }
                //})
            },
            convert: function () {
                var locationName = document.getElementById("locationName").value;
                var myVar = web3.fromUtf8(locationName);
                console.log("zero = " + myVar);
                console.log("one = " + web3.toUtf8(myVar));
            },
            addNewLocation: function () {
                var contractAddress = document.getElementById("contractAddress").value;
                var deployedFoodSafe = foodSafeContract.at(contractAddress);
                var locationId = document.getElementById("locationId").value;
                var locationName = web3.fromUtf8(document.getElementById("locationName").value);
                console.log("two = " + locationName);
                var locationSecret = document.getElementById("secret").value;
                var passPhrase = document.getElementById("passPhrase").value;
                var encryptedSecret = CryptoJS.AES.encrypt(locationSecret, passPhrase).toString();

                var result = deployedFoodSafe.insertUpdateQuestion(locationId, locationSecret, locationName, "For", 1, function (error, result) {
                    console.log(error);
                    console.log("result =" + JSON.stringify(result));
                })

                //console.log("result = " + JSON.stringify(result));

                //deployedFoodSafe.AddNewLocation(locationId, locationName, encryptedSecret, function (error) {
                //    console.log(error);
                //})
            },
            addLine: function () {
                var contractAddress = document.getElementById("contractAddress").value;
                var deployedFoodSafe = foodSafeContract.at(contractAddress);
                var locationId = document.getElementById("locationId").value;
                var locationName = web3.fromUtf8(document.getElementById("locationName").value);
                console.log("two = " + locationName);
                var locationSecret = document.getElementById("secret").value;
                var passPhrase = document.getElementById("passPhrase").value;
                var encryptedSecret = CryptoJS.AES.encrypt(locationSecret, passPhrase).toString();

                var result = deployedFoodSafe.addQuestionTextRow(locationId, locationSecret, locationName, function (error, result) {
                    console.log(error);
                    console.log("result =" + JSON.stringify(result));
                })
            },
            getCurrentLocation: function () {
                var contractAddress = document.getElementById("contractAddress").value;
                var deployedFoodSafe = foodSafeContract.at(contractAddress);
                var passPhrase = document.getElementById("passPhrase").value;

                deployedFoodSafe.getQuestionTextByRow.call("2",1, function (error, total) {
                    console.log("Row =" + total);
                })
                deployedFoodSafe.totalQuestions.call(function (error, total) {
                    console.log("total = " + total);
                    for (var x = 0; x < total; x++) {
                        deployedFoodSafe.getQuestionByIndex.call(x, function (error, question) {

                            console.log(question);

                        });
                    }
                })
            }
        };

        window.addEventListener('load', function () {
            if (typeof web3 !== 'undefined') {
                console.warn("Using web3 detected from external source.  If using MetaMask, see the following link. Feel free to delete this warning. :) http://truffleframework.com/tutorials/truffle-and-metamask")
                window.web3 = new Web3(web3.currentProvider);
            } else {
                console.warn("No web3 detected. Falling back to http://localhost:8545. You should remove this fallback when you deploy live, as it's inherently insecure. Consider switching to Metamask for development. More info here: http://truffleframework.com/tutorials/truffle-and-metamask");
                // fallback - use your fallback strategy (local node / hosted node + in-dapp id mgmt / fail)
                window.web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
            }
            App.start();
        });


    </script>
</head>
<body>
    <h1>FoodSafe</h1>

    <br> <label for="contractAddress">Contract Address:</label> <input type="text" id="contractAddress" placeholder="Scan address or create a new contract"></input>
    <br> <label for="locationId">Location Id:</label> <input type="text" id="locationId" placeholder="Enter the ID of the location"></input>
    <br> <label for="locationName">Location Name:</label> <input type="text" id="locationName" placeholder="Location name"></input>
    <br> <label for="secret">Secret:</label> <input type="text" id="secret" placeholder="Enter secret"></input>
    <br> <label for="passPhrase">Passphrase:</label> <input type="text" id="passPhrase" placeholder="Enter or scan passphrase"></input>
    <br><label for="ABI">ABI:</label> <textarea id="ABI" cols="60" rows="20"></textarea>
    <br><label for="byteCode">byteCode:</label> <textarea id="byteCode" cols="60" rows="20"></textarea>
    <br />
    <button id="tester" onclick="App.convert()">Convert</button>
    <br> <br>
    <button id="tester" onclick="App.testCall()">Click here</button>
    <br> <br>
    <button id="vote" onclick="App.vote()">Vote</button>
    <br> <br>
    <button id="createContract" onclick="App.createContract()">Create New Contract</button>
    <br> <br>
    <button id="addNewLocation" onclick="App.addNewLocation()">Add New Location</button>
    <br> <br>
    <button id="addline" onclick="App.addLine()">Add Line</button>
    <br> <br>
    <button id="getCurrentLocation" onclick="App.getCurrentLocation()">Get the current Location</button>

</body>
</html>
